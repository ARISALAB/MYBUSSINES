<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Καταγραφή Ραντεβού</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Καταγραφή Ραντεβού</h1>
    <form id="appointment-form">
        <label for="appointment-date">Ημερομηνία</label>
        <input type="date" id="appointment-date" required>

        <label for="appointment-time">Ώρα</label>
        <input type="time" id="appointment-time" required>

        <label for="first-name">Όνομα</label>
        <input type="text" id="first-name" required>

        <label for="last-name">Επώνυμο</label>
        <input type="text" id="last-name" required>

        <label for="phone">Τηλέφωνο</label>
        <input type="tel" id="phone" required>

        <label for="email">Email</label>
        <input type="email" id="email" required>

        <input type="submit" value="Καταχώριση Ραντεβού">
    </form>

    <h2>Ραντεβού για την Ημερομηνία: <span id="selected-date">-</span></h2>
    <table id="appointments-table" border="1">
        <thead>
            <tr>
                <th>Ώρα</th>
                <th>Όνομα</th>
                <th>Επώνυμο</th>
                <th>Τηλέφωνο</th>
                <th>Email</th>
                <th>Ενέργειες</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const appointmentForm = document.getElementById('appointment-form');
            const appointmentDate = document.getElementById('appointment-date');
            const appointmentTime = document.getElementById('appointment-time');
            const firstName = document.getElementById('first-name');
            const lastName = document.getElementById('last-name');
            const phone = document.getElementById('phone');
            const email = document.getElementById('email');
            const appointmentsTable = document.getElementById('appointments-table').querySelector('tbody');
            const selectedDateDisplay = document.getElementById('selected-date');

            let appointments = JSON.parse(localStorage.getItem('appointments')) || {};

            function saveAppointments() {
                localStorage.setItem('appointments', JSON.stringify(appointments));
            }

            function renderAppointments(date) {
                selectedDateDisplay.textContent = date || '-';
                appointmentsTable.innerHTML = '';

                if (appointments[date]) {
                    // Ταξινόμηση των ραντεβού με βάση την ώρα
                    appointments[date].sort((a, b) => a.time.localeCompare(b.time));

                    appointments[date].forEach((appt, index) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${appt.time}</td>
                            <td>${appt.firstName}</td>
                            <td>${appt.lastName}</td>
                            <td>${appt.phone}</td>
                            <td>${appt.email}</td>
                            <td>
                                <button data-index="${index}" class="edit-btn">Επεξεργασία</button>
                                <button data-index="${index}" class="delete-btn">Διαγραφή</button>
                            </td>
                        `;
                        appointmentsTable.appendChild(row);
                    });
                }
            }

            function addAppointment(e) {
                e.preventDefault();

                const date = appointmentDate.value;
                const time = appointmentTime.value;
                const fname = firstName.value.trim();
                const lname = lastName.value.trim();
                const phoneNumber = phone.value.trim();
                const emailAddress = email.value.trim();

                if (!date || !time || !fname || !lname || !phoneNumber || !emailAddress) {
                    alert('Παρακαλώ συμπληρώστε όλα τα πεδία.');
                    return;
                }

                if (!appointments[date]) {
                    appointments[date] = [];
                }

                appointments[date].push({
                    time,
                    firstName: fname,
                    lastName: lname,
                    phone: phoneNumber,
                    email: emailAddress
                });

                saveAppointments();
                renderAppointments(date);
                appointmentForm.reset();
                appointmentDate.value = date;
            }

            function editAppointment(date, index) {
                const appointment = appointments[date][index];

                appointmentDate.value = date;
                appointmentTime.value = appointment.time;
                firstName.value = appointment.firstName;
                lastName.value = appointment.lastName;
                phone.value = appointment.phone;
                email.value = appointment.email;

                deleteAppointment(date, index);
            }

            function deleteAppointment(date, index) {
                appointments[date].splice(index, 1);

                if (appointments[date].length === 0) {
                    delete appointments[date];
                }

                saveAppointments();
                renderAppointments(date);
            }

            appointmentsTable.addEventListener('click', (e) => {
                const date = appointmentDate.value;
                const index = e.target.getAttribute('data-index');

                if (e.target.classList.contains('delete-btn')) {
                    deleteAppointment(date, index);
                }

                if (e.target.classList.contains('edit-btn')) {
                    editAppointment(date, index);
                }
            });

            appointmentDate.addEventListener('change', (e) => {
                renderAppointments(e.target.value);
            });

            appointmentForm.addEventListener('submit', addAppointment);

            const today = new Date().toISOString().split('T')[0];
            appointmentDate.value = today;
            renderAppointments(today);
        });
    </script>
</body>
</html>
