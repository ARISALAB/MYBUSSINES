<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css"> <!-- Σύνδεσμος στο αρχείο CSS -->
    <link rel="icon" href="11.png" type="image/png">

    <title>Ετήσια Αναφορά</title>
    <style>
      


      
        /* CSS Κλάσεις για το πράσινο και πορτοκαλί φόντο */
        .highlight-green {
            background-color: #28a745;
            color: white;
            padding: 5px;
            border-radius: 5px;
        }
        .highlight-orange {
            background-color: #fd7e14;
            color: white;
            padding: 5px;
            border-radius: 5px;
        }
        /* Στυλ για τις παραγράφους με τα δεδομένα */
#highest-monthly-earnings,
#monthly-average {
    font-size: 16px; /* Μέγεθος γραμματοσειράς για καλή αναγνωσιμότητα */
    font-weight: bold; /* Ενίσχυση της γραμματοσειράς για έμφαση */
    color: #333; /* Χρώμα γραμματοσειράς για καλή αντίθεση */
    margin-top: 10px; /* Περιθώριο πάνω από κάθε παράγραφο */
    margin-bottom: 10px; /* Περιθώριο κάτω από κάθε παράγραφο */
}

/* Responsive στυλ για μικρές οθόνες */
@media (max-width: 600px) {
    #highest-monthly-earnings,
    #monthly-average {
        font-size: 14px; /* Μικρότερο μέγεθος γραμματοσειράς για μικρές οθόνες */
        margin-top: 8px; /* Μικρότερο περιθώριο για καλύτερη προσαρμογή */
        margin-bottom: 8px; /* Μικρότερο περιθώριο για καλύτερη προσαρμογή */
    }
}

    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
   <nav>
        <img src="11.png" alt="Logo" class="logo">
        <button class="menu-toggle">
            &#9776;<br>Menu
        </button>
        <div class="menu-items">
            <a href="index.html">Αρχική Σελίδα</a>
    
            <div class="dropdown">
                <a href="#">Συναλλαγές &#9662;</a>
                <div class="dropdown-content">
                    <a href="index1.html">Καταγραφή Συναλλαγών</a>
                    <a href="index4.html">Τιμολόγια Επί Πιστώσει</a>
                    <a href="index5.html">Πληρωμές Τράπεζας</a>
                </div>
            </div>
    
            <a href="index3.html">Καταγραφή Εσόδων</a>
            <a href="index2.html">Καρτέλες Προμηθευτών</a>
    
            <div class="dropdown">
                <a href="#">Αναφορές &#9662;</a>
                <div class="dropdown-content">
                    <a href="index7.html">Ημερήσια Αναφορά</a>
                    <a href="index6.html">Εβδομαδιαία Αναφορά</a>
                    <a href="index8.html">Μηνιαία Αναφορά</a>
                    <a href="index9.html">Ετήσια Αναφορά</a>
                </div>
            </div>
    
            <div class="dropdown">
                <a href="#">Προσωπικό &#9662;</a>
                <div class="dropdown-content">
                    <a href="employee-management.html">Καταγραφή Προσωπικού</a>
                    <a href="salary.html">Καταγραφή Μισθοδοσίας</a>
                    <a href="weekly-salary.html">Εβδομαδιαία Μισθοδοσία </a>
                    <a href="salary-report.html">Αναφορά Μισθοδοσίας</a>
                    

                </div>
            </div>
        </div>
    </nav>
    

    <div id="menuModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <a href="index.html">Αρχική Σελίδα</a>
            
            <div class="dropdown">
                <a href="#">Συναλλαγές</a>
                <div class="dropdown-content">
                    <a href="index1.html">Καταγραφή Συναλλαγών</a>
                    <a href="index4.html">Τιμολόγια Επί Πιστώσει</a>
                    <a href="index5.html">Πληρωμές Τράπεζας</a>
                </div>
            </div>
            
            <a href="index3.html">Καταγραφή Εσόδων</a>
            <a href="index2.html">Καρτέλες Προμηθευτών</a>
            
            <div class="dropdown">
                <a href="#">Αναφορές</a>
                <div class="dropdown-content">
                    <a href="index7.html">Ημερήσια Αναφορά</a>
                    <a href="index6.html">Εβδομαδιαία Αναφορά</a>
                    <a href="index8.html">Μηνιαία Αναφορά</a>
                    <a href="index9.html">Ετήσια Αναφορά</a>
                </div>
            </div>
            
            <!-- Νέα ενότητα για Προσωπικό -->
            <div class="dropdown">
                <a href="#">Προσωπικό &#9662;</a>
                <div class="dropdown-content">
                    <a href="employee-management.html">Καταγραφή Προσωπικού</a>
                    <a href="salary.html">Καταγραφή Μισθοδοσίας</a>
                    <a href="weekly-salary.html">Εβδομαδιαία Μισθοδοσία</a>
                    <a href="salary-report.html">Αναφορά Μισθοδοσίας</a>
                </div>
            </div>
            
        </div>
    </div>

    <h1>Ετήσια Αναφορά</h1>
    <form id="year-form">
        <label for="year">Επιλέξτε Έτος</label>
        <input type="number" id="year" min="2000" max="2100" required>
        <input type="submit" value="Προβολή Αναφοράς">
    </form>

    <table id="yearly-report">
        <thead>
            <tr>
                <th>Μήνας</th>
                <th>Ταμείο (€)</th>
                <th>Έσοδα από Κάρτα (€)</th>
                <th>Έσοδα από Μετρητά (€)</th>
                <th>Πληρωμές (€)</th>
                <th>Υπόλοιπο Μετρητών (€)</th>
                <th>Τιμολόγια Επί Πιστώσει (€)</th>
                <th>Καταθέσεις (€)</th>
            </tr>
        </thead>
        <tbody>
            <!-- Rows will be dynamically added here -->
        </tbody>
    </table>

    <p id="total-yearly-cash">Ταμείο Έτους: 0.00 €</p>
    <p id="total-card-income">Τραπεζικά Έσοδα: 0.00 €</p>
    <p id="total-cash-balance">Μετρητά: 0.00 €</p>
    <p id="total-credit-invoices">Εκκρεμότητες: 0.00 €</p>

    <!-- Προσθέστε το στοιχείο canvas για το γράφημα -->
    <canvas id="yearlyIncomeChart" width="400" height="200"></canvas>

    <!-- Προσθέστε σημεία για να εμφανίσετε τα αποτελέσματα -->
    <p id="highest-monthly-earnings"></p>
    <p id="monthly-average"></p>

    <footer>&copy; 2024 Ετήσια Αναφορά</footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const yearForm = document.getElementById('year-form');
            const yearInput = document.getElementById('year');
            const yearlyReportTableBody = document.querySelector('#yearly-report tbody');
            const totalYearlyCashDisplay = document.getElementById('total-yearly-cash');
            const totalCardIncomeDisplay = document.getElementById('total-card-income');
            const totalCashBalanceDisplay = document.getElementById('total-cash-balance');
            const totalCreditInvoicesDisplay = document.getElementById('total-credit-invoices');
            const yearlyIncomeChartCanvas = document.getElementById('yearlyIncomeChart');
            const highestMonthlyEarningsDisplay = document.getElementById('highest-monthly-earnings');
            const monthlyAverageDisplay = document.getElementById('monthly-average');

            let chartInstance = null;

            // Data directories
            const paymentDir = 'payments';
            const revenueDir = 'revenueData';
            const creditInvoicesDir = 'credit-invoices';
            const depositDir = 'bank-payments';

            // Load stored data
            let payments = JSON.parse(localStorage.getItem(paymentDir)) || {};
            let revenueData = JSON.parse(localStorage.getItem(revenueDir)) || {};
            let creditInvoices = JSON.parse(localStorage.getItem(creditInvoicesDir)) || {};
            let deposits = JSON.parse(localStorage.getItem(depositDir)) || {};

            function getMonthRange(year, monthIndex) {
                const start = new Date(year, monthIndex, 2);
                const end = new Date(year, monthIndex + 1);
                return { start, end };
            }

            function formatDateString(date) {
                return date.toISOString().split('T')[0];
            }

            function renderYearlyReport(yearlyData) {
                yearlyReportTableBody.innerHTML = '';

                let totalYearlyCashIncome = 0;
                let totalYearlyCardIncome = 0;
                let totalYearlyCashIncomeFromCash = 0;
                let totalYearlyPayments = 0;
                let totalYearlyCashBalance = 0;
                let totalYearlyCreditInvoices = 0;
                let totalYearlyDeposits = 0;

                const labels = [];
                const cashIncomeData = [];
                const cardIncomeData = [];
                const cashExpenseData = []; // Νέα σειρά για έξοδα μετρητών

                let highestMonthlyEarnings = { month: null, amount: 0 };
                let totalMonths = 0;

                Object.keys(yearlyData).forEach(month => {
                    const data = yearlyData[month];
                    const cashIncome = data.cashIncome;
                    const cardIncome = data.cardIncome;
                    const payments = data.payments;
                    const cashExpenses = data.cashExpenses; // Νέα δεδομένα για έξοδα μετρητών

                    const cashIncomeFromCash = cashIncome - cardIncome;
                    const cashBalance = cashIncome - cardIncome - payments;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${month}</td>
                        <td>${cashIncome.toFixed(2)}</td>
                        <td>${cardIncome.toFixed(2)}</td>
                        <td>${cashIncomeFromCash.toFixed(2)}</td>
                        <td>${payments.toFixed(2)}</td>
                        <td>${cashBalance.toFixed(2)}</td>
                        <td>${data.creditInvoices.toFixed(2)}</td>
                        <td>${data.deposits.toFixed(2)}</td>
                    `;
                    yearlyReportTableBody.appendChild(row);

                    totalYearlyCashIncome += cashIncome;
                    totalYearlyCardIncome += cardIncome;
                    totalYearlyCashIncomeFromCash += cashIncomeFromCash;
                    totalYearlyPayments += payments;
                    totalYearlyCashBalance += cashBalance;
                    totalYearlyCreditInvoices += data.creditInvoices;
                    totalYearlyDeposits += data.deposits;

                    labels.push(month);
                    cashIncomeData.push(cashIncome);
                    cardIncomeData.push(cardIncome);
                    cashExpenseData.push(cashExpenses); // Νέα δεδομένα για έξοδα μετρητών

                    // Ενημερώστε για τον μήνα με τα υψηλότερα έσοδα από μετρητά
                    if (cashIncome > highestMonthlyEarnings.amount) {
                        highestMonthlyEarnings = { month, amount: cashIncome };
                    }

                    totalMonths++;
                });

                // Δημιουργία γραμμής συνολικών
                const totalRow = document.createElement('tr');
                totalRow.innerHTML = `
                    <td><strong>Σύνολο:</strong></td>
                    <td><strong>${totalYearlyCashIncome.toFixed(2)}</strong></td>
                    <td><strong>${totalYearlyCardIncome.toFixed(2)}</strong></td>
                    <td><strong>${totalYearlyCashIncomeFromCash.toFixed(2)}</strong></td>
                    <td><strong>${totalYearlyPayments.toFixed(2)}</strong></td>
                    <td><strong>${totalYearlyCashBalance.toFixed(2)}</strong></td>
                    <td><strong>${totalYearlyCreditInvoices.toFixed(2)}</strong></td>
                    <td><strong>${totalYearlyDeposits.toFixed(2)}</strong></td>
                `;
                yearlyReportTableBody.appendChild(totalRow);

                // Ενημέρωση των συνολικών ποσών
                totalYearlyCashDisplay.textContent = `Ταμείο Έτους: ${totalYearlyCashIncome.toFixed(2)} €`;
                totalCardIncomeDisplay.textContent = `Τραπεζικά Έσοδα: ${totalYearlyCardIncome.toFixed(2)} €`;
                totalCashBalanceDisplay.textContent = `Μετρητά: ${totalYearlyCashBalance.toFixed(2)} €`;
                totalCreditInvoicesDisplay.textContent = `Εκκρεμότητες: ${totalYearlyCreditInvoices.toFixed(2)} €`;

                // Υπολογισμός μέσου όρου εσόδων ανά μήνα
                const monthlyAverage = totalYearlyCashIncomeFromCash / totalMonths;
                monthlyAverageDisplay.innerHTML = `Ο μηνιαίος Μέσος Όρος ήταν <span class="highlight-orange">${monthlyAverage.toFixed(2)} €</span>`;

                // Ενημέρωση του μήνα με τα υψηλότερα έσοδα
                highestMonthlyEarningsDisplay.innerHTML = `Ο μήνας με τα περισσότερα έσοδα ήταν ο: ${highestMonthlyEarnings.month} με ποσό <span class="highlight-green">${highestMonthlyEarnings.amount.toFixed(2)} €</span>`;

                // Δημιουργία ή Ενημέρωση του Γραφήματος
                if (chartInstance) {
                    chartInstance.destroy();
                }

                chartInstance = new Chart(yearlyIncomeChartCanvas, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Έσοδα από Κάρτα (€)',
                                data: cardIncomeData,
                                borderColor: '#28a745',
                                backgroundColor: 'rgba(40, 167, 69, 0.2)',
                                fill: false
                            },
                            {
                                label: 'Έσοδα από Μετρητά (€)',
                                data: cashIncomeData,
                                borderColor: '#007bff',
                                backgroundColor: 'rgba(0, 123, 255, 0.2)',
                                fill: false
                            },
                            {
                                label: 'Έξοδα από Μετρητά (€)',
                                data: cashExpenseData,
                                borderColor: '#dc3545',
                                backgroundColor: 'rgba(220, 53, 69, 0.2)',
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(tooltipItem) {
                                        return `${tooltipItem.dataset.label}: ${tooltipItem.raw.toFixed(2)} €`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Μήνας'
                                }
                            },
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            function loadYearlyReport(year) {
                const yearlyData = {};

                for (let month = 0; month < 12; month++) {
                    const { start, end } = getMonthRange(year, month);
                    const monthStr = start.toLocaleString('el', { month: 'long' });

                    let cashIncome = 0;
                    let cardIncome = 0;
                    let totalPayments = 0;
                    let totalCreditInvoices = 0;
                    let totalDeposits = 0;

                    for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                        const dateStr = formatDateString(d);

                        cashIncome += revenueData[dateStr]?.cash || 0;
                        cardIncome += revenueData[dateStr]?.card || 0;
                        totalPayments += payments[dateStr]?.reduce((total, payment) => total + payment.amount, 0) || 0;
                        totalCreditInvoices += creditInvoices[dateStr]?.reduce((total, invoice) => total + invoice.amount, 0) || 0;
                        totalDeposits += deposits[dateStr]?.reduce((total, deposit) => total + deposit.amount, 0) || 0;
                    }

                    // Υπολογισμός εξόδων μετρητών
                    const cashExpenses = totalPayments;

                    yearlyData[monthStr] = {
                        cashIncome,
                        cardIncome,
                        payments: totalPayments,
                        cashExpenses, // Νέα δεδομένα για έξοδα μετρητών
                        creditInvoices: totalCreditInvoices,
                        deposits: totalDeposits
                    };
                }

                renderYearlyReport(yearlyData);
            }

            yearForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const year = yearInput.value;
                loadYearlyReport(year);
            });
        });
    </script>
    <script>
        document.querySelector('.menu-toggle').addEventListener('click', function() {
            document.getElementById('menuModal').style.display = 'flex';
        });
        
        document.querySelector('.close').addEventListener('click', function() {
            document.getElementById('menuModal').style.display = 'none';
        });
        
        window.onclick = function(event) {
            if (event.target == document.getElementById('menuModal')) {
                document.getElementById('menuModal').style.display = 'none';
            }
        }
        
        // Κώδικας για την απόκρυψη του toggle menu όταν μεγαλώνει η οθόνη
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                document.getElementById('menuModal').style.display = 'none';
            }
        });
        
        </script>
        
        
</body>
</html>
